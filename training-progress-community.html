<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schafkopf KI-Training Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: #333; min-height: 100vh; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); }
        .header { text-align: center; margin-bottom: 40px; border-bottom: 3px solid #2a5298; padding-bottom: 20px; }
        .header h1 { color: #1e3c72; font-size: 2.5em; margin-bottom: 10px; }
        .header p { color: #6c757d; font-size: 1.1em; }
        .ai-badge { display: inline-block; background: linear-gradient(45deg, #6f42c1, #5a2d91); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.9em; font-weight: bold; margin: 5px; }
        .qlearning-badge { background: linear-gradient(45deg, #28a745, #20c997); }
        
        .status-section { background: #fff; border-radius: 15px; padding: 25px; margin: 20px 0; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); border: 1px solid #e9ecef; }
        .status-section h3 { color: #1e3c72; margin-bottom: 20px; font-size: 1.4em; }
        
        .system-status { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .status-item { background: linear-gradient(145deg, #f8f9fa, #e9ecef); border-radius: 10px; padding: 20px; text-align: center; border-left: 4px solid #2a5298; }
        .status-item.active { border-left-color: #28a745; background: linear-gradient(145deg, #d1f2eb, #a3e4d7); }
        .status-item.inactive { border-left-color: #dc3545; background: linear-gradient(145deg, #f8d7da, #f1aeb5); }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 15px; }
        .stat-card { background: linear-gradient(145deg, #f8f9fa, #e9ecef); border-radius: 10px; padding: 20px; text-align: center; border: 1px solid #dee2e6; }
        .stat-value { font-size: 2em; font-weight: bold; color: #2a5298; margin-bottom: 5px; }
        .stat-value.success { color: #28a745; }
        .stat-value.warning { color: #ffc107; }
        .stat-value.error { color: #dc3545; }
        .stat-label { font-size: 0.9em; color: #6c757d; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .ai-learning-stats { background: linear-gradient(145deg, #e8f5e8, #d4edda); border-radius: 10px; padding: 20px; margin-top: 20px; border-left: 4px solid #28a745; }
        .ai-learning-stats h4 { color: #155724; margin-bottom: 15px; font-size: 1.2em; }
        .learning-item { display: flex; justify-content: space-between; margin: 10px 0; font-size: 0.95em; }
        .learning-value { font-weight: bold; color: #155724; }
        
        .button { background: #2a5298; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 1em; margin: 5px; transition: all 0.3s ease; text-decoration: none; display: inline-block; }
        .button:hover { background: #1e3c72; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); }
        .button.success { background: #28a745; }
        .button.success:hover { background: #1e7e34; }
        .button.warning { background: #ffc107; color: #333; }
        .button.warning:hover { background: #e0a800; }
        .button:disabled { background: #6c757d; cursor: not-allowed; transform: none; }
        
        .loading { text-align: center; padding: 40px; color: #6c757d; }
        .loading-spinner { display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #2a5298; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        .info-text { font-size: 0.9em; color: #6c757d; margin-top: 10px; line-height: 1.4; }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (max-width: 768px) { .container { padding: 20px; margin: 10px; } .system-status { grid-template-columns: 1fr; } .stats-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† KI-Training Dashboard</h1>
            <p>Verfolge wie die KI aus deinen Reviews lernt</p>
            <span class="ai-badge qlearning-badge">ü§ñ Q-Learning Aktiv</span>
            <span class="ai-badge">üìä Lokale Statistiken</span>
        </div>

        <div class="status-section">
            <h3>‚ö° System Status</h3>
            <div class="system-status">
                <div id="qlearning-status" class="status-item">
                    <div class="loading-spinner"></div>
                    <div>Q-Learning System wird gepr√ºft...</div>
                </div>
                <div id="training-status" class="status-item">
                    <div class="loading-spinner"></div>
                    <div>Training System wird gepr√ºft...</div>
                </div>
                <div id="data-status" class="status-item">
                    <div class="loading-spinner"></div>
                    <div>Lokale Daten werden geladen...</div>
                </div>
            </div>
        </div>

        <div class="status-section">
            <h3>üìä Deine Review-Statistiken</h3>
            <div id="local-stats"><div class="loading"><div class="loading-spinner"></div>Lade deine Statistiken...</div></div>
        </div>

        <div class="status-section">
            <h3>üß† KI-Learning Status</h3>
            <div id="ai-learning-stats"><div class="loading"><div class="loading-spinner"></div>Lade KI-Learning Daten...</div></div>
        </div>

        <div class="status-section">
            <h3>‚öôÔ∏è Aktionen</h3>
            <button class="button" onclick="refreshAllData()">üîÑ Daten aktualisieren</button>
            <button class="button success" onclick="exportLocalData()">üì• Daten exportieren</button>
            <button class="button warning" onclick="triggerQLearning()">üß† Q-Learning manuell starten</button>
            <button class="button" onclick="window.location.href='index.html'">üéÆ Zur√ºck zum Spiel</button>
        </div>
    </div>

    <!-- Nur die erforderlichen Q-Learning Scripts -->
    <script src="js/ai/post-game-training.js?v=20250815-clean"></script>
    <script src="community-qlearning-bridge.js?v=20250815-clean"></script>

    <script>
        let dashboardData = null;
        console.log('üß† Simplified KI-Training Dashboard v3.0');

        async function initDashboard() {
            try {
                console.log('üß† Initializing simplified dashboard...');
                await waitForSystems();
                await loadLocalData();
                updateAllDisplays();
                console.log('‚úÖ Dashboard initialized successfully');
            } catch (error) {
                console.error('‚ùå Dashboard initialization failed:', error);
                showErrorState();
            }
        }

        async function waitForSystems() {
            return new Promise((resolve) => {
                let attempts = 0;
                const maxAttempts = 20;
                function checkSystems() {
                    const qlearningAvailable = !!window.getQLearningStats;
                    const trainingAvailable = !!window.postGameTraining;
                    
                    if (qlearningAvailable || trainingAvailable || attempts >= maxAttempts) {
                        console.log(`‚úÖ Systems check complete (${attempts}/${maxAttempts})`);
                        console.log(`Q-Learning: ${qlearningAvailable ? '‚úÖ' : '‚ùå'}`);
                        console.log(`Training: ${trainingAvailable ? '‚úÖ' : '‚ùå'}`);
                        resolve();
                    } else {
                        attempts++;
                        setTimeout(checkSystems, 300);
                    }
                }
                checkSystems();
            });
        }

        async function loadLocalData() {
            try {
                console.log('üìä Loading local data...');
                
                // Lokale Reviews laden
                const localReviews = JSON.parse(localStorage.getItem('training_reviews') || '[]');
                const positiveReviews = localReviews.filter(r => r.rating === 'good').length;
                const negativeReviews = localReviews.filter(r => r.rating === 'bad').length;
                
                // Q-Learning Stats
                let qLearningData = null;
                try {
                    if (window.getQLearningStats) {
                        qLearningData = window.getQLearningStats();
                    }
                } catch (error) {
                    console.log('Q-Learning Stats nicht verf√ºgbar:', error);
                }
                
                dashboardData = {
                    local: {
                        totalReviews: localReviews.length,
                        positiveReviews: positiveReviews,
                        negativeReviews: negativeReviews,
                        positiveRate: localReviews.length > 0 ? ((positiveReviews / localReviews.length) * 100).toFixed(1) : 0,
                        lastReview: localReviews.length > 0 ? localReviews[localReviews.length - 1].timestamp : null
                    },
                    qlearning: qLearningData || {
                        available: false,
                        reviewsProcessed: 0,
                        positiveSignals: 0,
                        negativeSignals: 0
                    },
                    systems: {
                        qlearning: !!window.getQLearningStats,
                        training: !!window.postGameTraining,
                        trainingEnabled: window.postGameTraining ? window.postGameTraining.enabled : false
                    }
                };
                
                console.log('‚úÖ Local data loaded:', dashboardData);
            } catch (error) {
                console.error('‚ùå Failed to load local data:', error);
                throw error;
            }
        }

        function updateAllDisplays() {
            updateSystemStatus();
            updateLocalStats();
            updateAILearningStats();
        }

        function updateSystemStatus() {
            const qlearningStatus = document.getElementById('qlearning-status');
            const trainingStatus = document.getElementById('training-status');
            const dataStatus = document.getElementById('data-status');
            
            if (!dashboardData) return;
            
            const { systems, local } = dashboardData;
            
            // Q-Learning Status
            if (systems.qlearning) {
                qlearningStatus.className = 'status-item active';
                qlearningStatus.innerHTML = '‚úÖ Q-Learning System verf√ºgbar';
            } else {
                qlearningStatus.className = 'status-item inactive';
                qlearningStatus.innerHTML = '‚ùå Q-Learning System nicht verf√ºgbar';
            }
            
            // Training Status
            if (systems.training) {
                if (systems.trainingEnabled) {
                    trainingStatus.className = 'status-item active';
                    trainingStatus.innerHTML = '‚úÖ Training System aktiv';
                } else {
                    trainingStatus.className = 'status-item';
                    trainingStatus.innerHTML = '‚è∏Ô∏è Training System bereit (nicht aktiv)';
                }
            } else {
                trainingStatus.className = 'status-item inactive';
                trainingStatus.innerHTML = '‚ùå Training System nicht verf√ºgbar';
            }
            
            // Data Status
            if (local.totalReviews > 0) {
                dataStatus.className = 'status-item active';
                dataStatus.innerHTML = `‚úÖ ${local.totalReviews} Reviews gespeichert`;
            } else {
                dataStatus.className = 'status-item';
                dataStatus.innerHTML = 'üìù Noch keine Reviews vorhanden';
            }
        }

        function updateLocalStats() {
            const statsEl = document.getElementById('local-stats');
            if (!dashboardData) return;
            
            const { local } = dashboardData;
            
            statsEl.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${local.totalReviews}</div>
                        <div class="stat-label">Deine Reviews</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value success">${local.positiveReviews}</div>
                        <div class="stat-label">Positive Bewertungen</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value error">${local.negativeReviews}</div>
                        <div class="stat-label">Negative Bewertungen</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value warning">${local.positiveRate}%</div>
                        <div class="stat-label">Positive Rate</div>
                    </div>
                </div>
                <div class="info-text">
                    ${local.lastReview ? 
                        `üìÖ Letzte Review: ${new Date(local.lastReview).toLocaleString('de-DE')}` : 
                        'üí° Spiele ein Spiel und bewerte die KI-Z√ºge um Reviews zu sammeln!'
                    }
                </div>
            `;
        }

        function updateAILearningStats() {
            const statsEl = document.getElementById('ai-learning-stats');
            if (!dashboardData) return;
            
            const { qlearning, systems } = dashboardData;
            
            if (!systems.qlearning || !qlearning.available) {
                statsEl.innerHTML = `
                    <div class="ai-learning-stats">
                        <h4>ü§ñ Q-Learning System</h4>
                        <div class="info-text">
                            ‚ö†Ô∏è Q-Learning System ist nicht verf√ºgbar. Starte ein neues Spiel um das System zu aktivieren.
                        </div>
                    </div>
                `;
                return;
            }
            
            const bridge = qlearning.bridge || {};
            const reviewsProcessed = bridge.reviewsProcessed || 0;
            const positiveSignals = bridge.positiveSignals || 0;
            const negativeSignals = bridge.negativeSignals || 0;
            
            statsEl.innerHTML = `
                <div class="ai-learning-stats">
                    <h4>üß† KI-Learning aktiv</h4>
                    <div class="learning-item">
                        <span>Reviews ‚Üí KI-Signale:</span>
                        <span class="learning-value">${reviewsProcessed}</span>
                    </div>
                    <div class="learning-item">
                        <span>Positive Signale:</span>
                        <span class="learning-value" style="color: #28a745;">${positiveSignals}</span>
                    </div>
                    <div class="learning-item">
                        <span>Negative Signale:</span>
                        <span class="learning-value" style="color: #dc3545;">${negativeSignals}</span>
                    </div>
                    <div class="info-text" style="margin-top: 15px; color: #155724;">
                        üöÄ Die KI lernt aus jeder deiner Bewertungen und wird kontinuierlich besser!
                        ${reviewsProcessed === 0 ? ' Bewerte ein paar KI-Z√ºge um das Learning zu starten.' : ''}
                    </div>
                </div>
            `;
        }

        async function refreshAllData() {
            console.log('üîÑ Manual refresh triggered');
            const button = event.target;
            const originalText = button.textContent;
            
            try {
                button.disabled = true;
                button.textContent = 'üîÑ Lade...';
                
                await loadLocalData();
                updateAllDisplays();
                
                button.textContent = '‚úÖ Aktualisiert!';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                }, 1500);
            } catch (error) {
                console.error('Refresh error:', error);
                button.textContent = '‚ùå Fehler';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                }, 2000);
            }
        }

        function exportLocalData() {
            if (!dashboardData) {
                alert('‚ùå Keine Daten zum Exportieren verf√ºgbar');
                return;
            }
            
            const exportData = {
                exported: new Date().toISOString(),
                version: '3.0-simplified',
                dashboard: dashboardData,
                localReviews: JSON.parse(localStorage.getItem('training_reviews') || '[]'),
                qlearning: window.getQLearningStats ? window.getQLearningStats() : null
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `schafkopf-ki-training-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('üì• Daten erfolgreich exportiert!');
        }

        async function triggerQLearning() {
            const button = event.target;
            const originalText = button.textContent;
            
            try {
                button.disabled = true;
                button.textContent = 'üß† Starte...';
                
                if (window.importReviewsToQLearning) {
                    window.importReviewsToQLearning();
                    
                    setTimeout(async () => {
                        await loadLocalData();
                        updateAllDisplays();
                        button.textContent = '‚úÖ Gestartet!';
                        
                        setTimeout(() => {
                            button.textContent = originalText;
                            button.disabled = false;
                        }, 1500);
                    }, 2000);
                } else {
                    throw new Error('Q-Learning System nicht verf√ºgbar');
                }
            } catch (error) {
                console.error('Q-Learning trigger error:', error);
                alert('‚ö†Ô∏è Q-Learning System nicht verf√ºgbar');
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        function showErrorState() {
            document.querySelector('.container').innerHTML = `
                <div class="header">
                    <h1>‚ùå Dashboard Fehler</h1>
                    <p>Das KI-Training Dashboard konnte nicht geladen werden</p>
                </div>
                <div style="text-align: center; padding: 40px;">
                    <button class="button" onclick="window.location.reload()">üîÑ Seite neu laden</button>
                    <button class="button" onclick="window.location.href='index.html'">üéÆ Zur√ºck zum Spiel</button>
                </div>
            `;
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(initDashboard, 1000);
        });
    </script>
</body>
</html>